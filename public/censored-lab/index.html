<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Censored Lab | Censored State</title>
<meta name="keywords" content="">
<meta name="description" content="Welcome to Censored Lab!

General Information
For general information about how censorship works, and information about IP Addresses, DNS, Deep Packet Inspection, and other subjects, see:
Censorship and Surveillance in the Digital Age: Part One
Censorship and Surveillance in the Digital Age: Part Two
Golden Shield: The Inner Workings of China&rsquo;s Great Firewall
Behind the Blackout: The Mechanisms, Monitoring, and Impact of Internet Shutdowns
See also the Resources Page of this blog for links to anti-censorship tools and other informational sites.">
<meta name="author" content="Merecat">
<link rel="canonical" href="https://censored-state.pages.dev/censored-lab/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css" integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF&#43;13Dyqob6ASlTrTye8=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://censored-state.pages.dev/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://censored-state.pages.dev/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://censored-state.pages.dev/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://censored-state.pages.dev/apple-touch-icon.png">
<link rel="mask-icon" href="https://censored-state.pages.dev/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://censored-state.pages.dev/censored-lab/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://censored-state.pages.dev/censored-lab/">
  <meta property="og:site_name" content="Censored State">
  <meta property="og:title" content="Censored Lab">
  <meta property="og:description" content="Welcome to Censored Lab!
General Information For general information about how censorship works, and information about IP Addresses, DNS, Deep Packet Inspection, and other subjects, see:
Censorship and Surveillance in the Digital Age: Part One
Censorship and Surveillance in the Digital Age: Part Two
Golden Shield: The Inner Workings of China’s Great Firewall
Behind the Blackout: The Mechanisms, Monitoring, and Impact of Internet Shutdowns
See also the Resources Page of this blog for links to anti-censorship tools and other informational sites.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:published_time" content="2025-05-31T13:28:03-04:00">
    <meta property="article:modified_time" content="2025-05-31T13:28:03-04:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Censored Lab">
<meta name="twitter:description" content="Welcome to Censored Lab!

General Information
For general information about how censorship works, and information about IP Addresses, DNS, Deep Packet Inspection, and other subjects, see:
Censorship and Surveillance in the Digital Age: Part One
Censorship and Surveillance in the Digital Age: Part Two
Golden Shield: The Inner Workings of China&rsquo;s Great Firewall
Behind the Blackout: The Mechanisms, Monitoring, and Impact of Internet Shutdowns
See also the Resources Page of this blog for links to anti-censorship tools and other informational sites.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Censored Lab",
      "item": "https://censored-state.pages.dev/censored-lab/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Censored Lab",
  "name": "Censored Lab",
  "description": "Welcome to Censored Lab!\nGeneral Information For general information about how censorship works, and information about IP Addresses, DNS, Deep Packet Inspection, and other subjects, see:\nCensorship and Surveillance in the Digital Age: Part One\nCensorship and Surveillance in the Digital Age: Part Two\nGolden Shield: The Inner Workings of China\u0026rsquo;s Great Firewall\nBehind the Blackout: The Mechanisms, Monitoring, and Impact of Internet Shutdowns\nSee also the Resources Page of this blog for links to anti-censorship tools and other informational sites.\n",
  "keywords": [
    
  ],
  "articleBody": "Welcome to Censored Lab!\nGeneral Information For general information about how censorship works, and information about IP Addresses, DNS, Deep Packet Inspection, and other subjects, see:\nCensorship and Surveillance in the Digital Age: Part One\nCensorship and Surveillance in the Digital Age: Part Two\nGolden Shield: The Inner Workings of China’s Great Firewall\nBehind the Blackout: The Mechanisms, Monitoring, and Impact of Internet Shutdowns\nSee also the Resources Page of this blog for links to anti-censorship tools and other informational sites.\nLab Setup For simulating online censorship, a lab can be set up using Virtualbox installed on a host computer. Virtualbox can be downloaded for Windows, MacOS, and Linux from HTTPS://www.virtualbox.org. Be sure to download and install the extension pack as well. For Ubuntu and other Linux distros, be sure to download the correct edition (i.e. Ubuntu 24.02) because unmet dependencies can be a problem. I recommend four different virtual machines:\nIPFire as a firewall. Will be used for simulating the actions of a government censor. Download here.\nWindows 10 as one of the censored computers. Should have Psiphon, Lantern, Tor, and a VPN installed. Use the Microsoft Media Creation Tool.\nKali Linux for running Wireshark. Can also be used as a censorship platform with iptables and dnsmasq (discussed later). Download here.\nUbuntu 24.04 as another censored machine. Download Here.\nNote: I have had different firewalls work better with certain hosts. IPFire works well on Windows, but other choices include OPNSense (complicated), PFSense (a little less complicated), ClearOS (hard to install) among others. IPFire is easy to install and configure.\nThe initial setup will look like this:\nThe IPFire virtual machine (VM) acts as our firewall, hands out IP Addresses to the other VMs via DHCP, and acts as a DNS server. When IPFire is set up on Virtualbox, there is a GREEN interface and a RED interface. In our case, the green interface is set to the internal network and the red interface to NAT which provides internet access via the host computer. Instructions for installing IPFire on Virtualbox can be found HERE, and instructions for IPFire networking HERE.\nThe subnet for the internal network is 192.168.1.0/24, and the IPFire VM has an IP Address of 192.168.1.1. Windows 10, Kali, and Ubuntu are all set to internal networking only. This means they can only access the internet via the firewall. So, network settings for all three need the following settings:\nReceive IP Address automatically (DHCP from IPFire)\nDNS server to IPFire IP Address (192.168.1.1)\nI disabled IPV6 for simplicity, but in real life IPV6 would also have to be blocked to censor access to DNA, etc.\nFor Kali, install Wireshark as follows (if not already installed);\nsudo apt update sudo apt install wireshark DNS Blocking and Poisoning Blocking DNS can be challenging. Modern browsers will fallback to any available DNS servers unless they are all blocked. Blocking DNS (port 53) only works if the browsers don’t have HTTPS over DNS (Port 443). Blocking all traffic to 443 blocks all websites, not just censored sites. Windows caches DNS, so the cache has to be cleared for previously visited sites.\nWith port 53 and port 443 NOT blocked and DNS servers not blocked, an nslookup (Windows) or dig (Linux) for bbc.com is run and works. Accessing BBC on firefox while Wireshark is running shows the DNS requests:\nBlocking all common DNS servers but not blocking all traffic to port 443 on IPFire and doing the same thing shows a different result. This involved adding rules blocking port 443 for\nCloudflare 1.1.1.1, 1.0.0.1 2606:4700:4700::1111 (IPv6)\nGoogle 8.8.8.8, 8.8.4.4 2001:4860:4860::8888 (IPv6)\nQuad9 9.9.9.9, 149.112.112.112\nNextDNS 45.90.28.0/24, 45.90.30.0/24\nOpenDNS 208.67.222.222, 208.67.220.220\nCleanBrowsing 185.228.168.168, 185.228.169.168\nAdGuard 94.140.14.14, 94.140.15.15\nComodo Secure DNS 8.26.56.26, 8.20.247.20\nNeustar UltraDNS 156.154.70.1, 156.154.71.1\nCloudflare for Families 1.1.1.2, 1.0.0.2\nWhen this is done, ping 8.8.8.8 works because it doesn’t require DNS, but dig google.com does not work (DNS is blocked). Lantern also does NOT work with DNS blocked. Tor does not access BBC.com but will connect. Wireshark with filters for port 53 or 443 doesn’t show any captures. This mimics real-world censorship in a country like China.\nSo, how does a person surfing the web in China get to a website since all foreign DNS serves are blocked? China has servers run by the government. This gives the PRC tight control over what sites can be reached (combined with other methods of censorship). The state controlled DNS servers can be configured to allow access to approved sites or to block or poison requests for censored sites.\nDNS poisoning can be demonstrated using dnsmasq on Kali. This requires a reconfiguration of the Virtualbox network so traffic from Windows or Ubuntu goes through Kali instead of IPFire. The new setup will look like this:\nKali has dnsmasq installed and also has the Linux firewall iptables. The dnsmasq program will be used to mimic DNS poisoning and can be installed with the commands:\nsudo apt update sudo apt install dnsmasq DNS on Ubuntu is set to Kali’s IP. To setup dnsmasq on Kali to block or poison DNS to certain sites, the config file needs to be edited:\nsudo nano /etc/dnsmasq.conf Then edit the file:\n# Basic DNS settings port=53 domain-needed bogus-priv no-resolv # Use public DNS servers upstream server=1.1.1.1 server=8.8.8.8 # Spoofed/poisoned domains address=/facebook.com/0.0.0.0 address=/youtube.com/0.0.0.0 address=/bbc.com/0.0.0.0 address=/twitter.com/0.0.0.0 address=/instagram.com/0.0.0.0 address=/wikipedia.org/0.0.0.0 Save this then exit. Now when Ubuntu is forced to use Kali’s DNS, dig facebook.com does not work, but dig google.com does. The DNS is poisoned and redirects to 0.0.0.0. This shows how DNS could be blocked by cenosrs. The problem with this method is that the censored computer (Ubuntu) has to have to many configuration changes to make it work. (I had to edit two other files to really block DNS). With Windows 10 instead of Ubuntu, though, DNS was blocked with just dnsmasq changes (the browser could not reach any blocked sites, but could reach any other site).\nIf Wireshark is run for the requests and filtered for DNS and DNS over HTTPS, surfing to google.com shows the normal DNS request:\nbbc.com on the other hand, shows:\nWhat’s really interesting, this was done with DNS over HTTPS off in Firefox. If Privacy and Security settings are changed to use DNS over HTTPS instead, the sites can be accessed. To block this too, DNS over port 443 for all or most common DNS servers has to be blocked as above.\nAnother interesting thing we can do is set up dnsmasq on Kali to log all attempts to reach blocked sites. We have to modify the config dnsmasq config file again and add\nlog-queries log-facility=/var/log/dnsmasq.log the restart dnsmasq:\nsudo systemctl restart dnsmasq and start logging:\nsudo tail -f /var/log/dnsmasq.log If the user on Windows tries to browse to facebook.com, the censor will see\nConclusion of This Section The goal of all of this is to simulate how a repressive government like China could block and poison DNS. One thing to add: since I am not an expert in networking (although I have a Network+ certification), I LIBERALLY relied on ChatGPT and Perplexity to help resolve problems and develop testing ideas. All the writing is mine, but much of the technical stuff would have been difficult without AI help.\n",
  "wordCount" : "1203",
  "inLanguage": "en",
  "datePublished": "2025-05-31T13:28:03-04:00",
  "dateModified": "2025-05-31T13:28:03-04:00",
  "author":{
    "@type": "Person",
    "name": "Merecat"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://censored-state.pages.dev/censored-lab/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Censored State",
    "logo": {
      "@type": "ImageObject",
      "url": "https://censored-state.pages.dev/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://censored-state.pages.dev/" accesskey="h" title="Censored State (Alt + H)">Censored State</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://censored-state.pages.dev/circumvention-tools" title="Resources and Tools">
                    <span>Resources and Tools</span>
                </a>
            </li>
            <li>
                <a href="https://censored-state.pages.dev/censored-lab" title="Censored Lab">
                    <span class="active">Censored Lab</span>
                </a>
            </li>
            <li>
                <a href="https://censored-state.pages.dev/about" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Censored Lab
    </h1>
    <div class="post-meta"><span title='2025-05-31 13:28:03 -0400 EDT'>May 31, 2025</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Merecat

</div>
  </header> 
  <div class="post-content"><p>Welcome to Censored Lab!</p>
<p><img alt="lab pic" loading="lazy" src="/images/lab_picture.jpg"></p>
<h3 id="general-information">General Information<a hidden class="anchor" aria-hidden="true" href="#general-information">#</a></h3>
<p>For general information about how censorship works, and information about IP Addresses, DNS, Deep Packet Inspection, and other subjects, see:</p>
<p><a href="https://merecat25.substack.com/p/censorship-and-surveillance-in-the">Censorship and Surveillance in the Digital Age: Part One</a></p>
<p><a href="https://merecat25.substack.com/p/censorship-and-surveillance-in-the-5a4">Censorship and Surveillance in the Digital Age: Part Two</a></p>
<p><a href="https://merecat25.substack.com/p/golden-shield-the-inner-workings">Golden Shield: The Inner Workings of China&rsquo;s Great Firewall</a></p>
<p><a href="https://merecat25.substack.com/p/golden-shield-the-inner-workings">Behind the Blackout: The Mechanisms, Monitoring, and Impact of Internet Shutdowns</a></p>
<p>See also the <a href="https://merecat25.substack.com/p/circumvention-tools">Resources Page</a> of this blog for links to anti-censorship tools and other informational sites.</p>
<h3 id="lab-setup">Lab Setup<a hidden class="anchor" aria-hidden="true" href="#lab-setup">#</a></h3>
<p>For simulating online censorship, a lab can be set up using Virtualbox installed on a host computer. Virtualbox can be downloaded for <strong>Windows, MacOS</strong>, and <strong>Linux</strong> from <a href="https://www.virtualbox.org/">HTTPS://www.virtualbox.org</a>. Be sure to download and install the <strong>extension pack</strong> as well. For Ubuntu and other Linux distros, be sure to download the correct edition (i.e. Ubuntu 24.02) because unmet dependencies can be a problem. I recommend four different virtual machines:</p>
<ul>
<li>
<p><strong>IPFire</strong> as a firewall. Will be used for simulating the actions of a government censor. <a href="https://www.ipfire.org/downloads/ipfire-2.29-core194">Download here</a>.</p>
</li>
<li>
<p><strong>Windows 10</strong> as one of the censored computers. Should have Psiphon, Lantern, Tor, and a VPN installed. Use the <a href="https://www.microsoft.com/en-us/software-download/windows10">Microsoft Media Creation Tool</a>.</p>
</li>
<li>
<p><strong>Kali Linux</strong> for running Wireshark. Can also be used as a censorship platform with iptables and dnsmasq (discussed later). <a href="https://www.kali.org/">Download here</a>.</p>
</li>
<li>
<p><strong>Ubuntu 24.04</strong> as another censored machine. <a href="https://ubuntu.com/download">Download Here</a>.</p>
</li>
</ul>
<p><em>Note: I have had different firewalls work better with certain hosts. IPFire works well on Windows, but other choices include OPNSense (complicated), PFSense (a little less complicated), ClearOS (hard to install) among others. IPFire is easy to install and configure.</em></p>
<p>The initial setup will look like this:</p>
<p><img alt="Network Diagram" loading="lazy" src="/images/setup1.png"></p>
<p>The IPFire virtual machine (VM) acts as our firewall, hands out IP Addresses to the other VMs via DHCP, and acts as a DNS server. When IPFire is set up on Virtualbox, there is a GREEN interface and a RED interface. In our case, the green interface is set to the internal network and the red interface to NAT which provides internet access via the host computer. Instructions for installing IPFire on Virtualbox can be found <a href="https://www.ipfire.org/docs/installation/virtual-box">HERE</a>, and instructions for IPFire networking <a href="https://www.ipfire.org/docs/installation/step5">HERE</a>.</p>
<p>The subnet for the internal network is 192.168.1.0/24, and the IPFire VM has an IP Address of 192.168.1.1. Windows 10, Kali, and Ubuntu are all set to internal networking only. This means they can only access the internet via the firewall. So, network settings for all three need the following settings:</p>
<ul>
<li>
<p>Receive IP Address automatically (DHCP from IPFire)</p>
</li>
<li>
<p>DNS server to IPFire IP Address (192.168.1.1)</p>
</li>
<li>
<p>I disabled IPV6 for simplicity, but in real life IPV6 would also have to be blocked to censor access to DNA, etc.</p>
</li>
</ul>
<p>For Kali, install Wireshark as follows (if not already installed);</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install wireshark
</span></span></code></pre></div><h3 id="dns-blocking-and-poisoning">DNS Blocking and Poisoning<a hidden class="anchor" aria-hidden="true" href="#dns-blocking-and-poisoning">#</a></h3>
<p>Blocking DNS can be challenging. Modern browsers will fallback to any available DNS servers unless they are all blocked. Blocking DNS (port 53) only works if the browsers don’t have HTTPS over DNS (Port 443). Blocking all traffic to 443 blocks all websites, not just censored sites. Windows caches DNS, so the cache has to be cleared for previously visited sites.</p>
<p>With port 53 and port 443 NOT blocked and DNS servers not blocked, an nslookup (Windows) or dig (Linux) for bbc.com is run and works. Accessing BBC on firefox while Wireshark is running shows the DNS requests:</p>
<p><img alt="dns open" loading="lazy" src="/images/dns_open.png"></p>
<p>Blocking all common DNS servers but not blocking all traffic to port 443 on IPFire and doing the same thing shows a different result. This involved adding rules blocking port 443 for</p>
<ul>
<li>
<p><strong>Cloudflare</strong> 1.1.1.1, 1.0.0.1 2606:4700:4700::1111 (IPv6)</p>
</li>
<li>
<p><strong>Google</strong> 8.8.8.8, 8.8.4.4 2001:4860:4860::8888 (IPv6)</p>
</li>
<li>
<p><strong>Quad9</strong> 9.9.9.9, 149.112.112.112</p>
</li>
<li>
<p><strong>NextDNS</strong> 45.90.28.0/24, 45.90.30.0/24</p>
</li>
<li>
<p><strong>OpenDNS</strong> 208.67.222.222, 208.67.220.220</p>
</li>
<li>
<p><strong>CleanBrowsing</strong> 185.228.168.168, 185.228.169.168</p>
</li>
<li>
<p><strong>AdGuard</strong> 94.140.14.14, 94.140.15.15</p>
</li>
<li>
<p><strong>Comodo Secure DNS</strong> 8.26.56.26, 8.20.247.20</p>
</li>
<li>
<p><strong>Neustar UltraDNS</strong> 156.154.70.1, 156.154.71.1</p>
</li>
<li>
<p><strong>Cloudflare for Families</strong> 1.1.1.2, 1.0.0.2</p>
</li>
</ul>
<p>When this is done, <em>ping 8.8.8.8</em> works because it doesn’t require DNS, but <em>dig google.com</em> does not work (DNS is blocked). Lantern also does NOT work with DNS blocked. Tor does not access BBC.com but will connect. Wireshark with filters for port 53 or 443 doesn’t show any captures. This mimics real-world censorship in a country like China.</p>
<p>So, how does a person surfing the web in China get to a website since all foreign DNS serves are blocked? China has servers run by the government. This gives the PRC tight control over what sites can be reached (combined with other methods of censorship). The state controlled DNS servers can be configured to allow access to approved sites or to block or poison requests for censored sites.</p>
<p><strong>DNS poisoning</strong> can be demonstrated using dnsmasq on Kali. This requires a reconfiguration of the Virtualbox network so traffic from Windows or Ubuntu goes through Kali instead of IPFire. The new setup will look like this:</p>
<p><img alt="setup two" loading="lazy" src="/images/setup2.png"></p>
<p>Kali has dnsmasq installed and also has the Linux firewall iptables. The dnsmasq program will be used to mimic DNS poisoning and can be installed with the commands:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install dnsmasq
</span></span></code></pre></div><p><strong>DNS on Ubuntu is set to Kali’s IP</strong>. To setup dnsmasq on Kali to block or poison DNS to certain sites, the config file needs to be edited:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nano /etc/dnsmasq.conf
</span></span></code></pre></div><p>Then edit the file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Basic DNS settings</span>
</span></span><span style="display:flex;"><span>port<span style="color:#f92672">=</span><span style="color:#ae81ff">53</span>
</span></span><span style="display:flex;"><span>domain-needed
</span></span><span style="display:flex;"><span>bogus-priv
</span></span><span style="display:flex;"><span>no-resolv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Use public DNS servers upstream</span>
</span></span><span style="display:flex;"><span>server<span style="color:#f92672">=</span>1.1.1.1
</span></span><span style="display:flex;"><span>server<span style="color:#f92672">=</span>8.8.8.8
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Spoofed/poisoned domains</span>
</span></span><span style="display:flex;"><span>address<span style="color:#f92672">=</span>/facebook.com/0.0.0.0
</span></span><span style="display:flex;"><span>address<span style="color:#f92672">=</span>/youtube.com/0.0.0.0
</span></span><span style="display:flex;"><span>address<span style="color:#f92672">=</span>/bbc.com/0.0.0.0
</span></span><span style="display:flex;"><span>address<span style="color:#f92672">=</span>/twitter.com/0.0.0.0
</span></span><span style="display:flex;"><span>address<span style="color:#f92672">=</span>/instagram.com/0.0.0.0
</span></span><span style="display:flex;"><span>address<span style="color:#f92672">=</span>/wikipedia.org/0.0.0.0
</span></span></code></pre></div><p>Save this then exit. Now when Ubuntu is forced to use Kali’s DNS, <em>dig facebook.com</em> does not work, but <em>dig google.com</em> does. The DNS is poisoned and redirects to 0.0.0.0. This shows how DNS could be blocked by cenosrs. The problem with this method is that the censored computer (Ubuntu) has to have to many configuration changes to make it work. (I had to edit two other files to really block DNS). With Windows 10 instead of Ubuntu, though, DNS was blocked with just dnsmasq changes (the browser could not reach any blocked sites, but could reach any other site).</p>
<p>If Wireshark is run for the requests and filtered for DNS and DNS over HTTPS, surfing to google.com shows the normal DNS request:</p>
<p><img alt="google dns" loading="lazy" src="/images/censored-lab/google_dns.png"></p>
<p>bbc.com on the other hand, shows:</p>
<p><img alt="bbc dns" loading="lazy" src="/images/censored-lab/bbc.png"></p>
<p>What’s really interesting, this was done with DNS over HTTPS off in Firefox. If Privacy and Security settings are changed to use DNS over HTTPS instead, the sites can be accessed. To block this too, DNS over port 443 for all or most common DNS servers has to be blocked as above.</p>
<p>Another interesting thing we can do is set up dnsmasq on Kali to log all attempts to reach blocked sites. We have to modify the config dnsmasq config file again and add</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>log-queries
</span></span><span style="display:flex;"><span>log-facility<span style="color:#f92672">=</span>/var/log/dnsmasq.log
</span></span></code></pre></div><p>the restart dnsmasq:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl restart dnsmasq
</span></span></code></pre></div><p>and start logging:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo tail -f /var/log/dnsmasq.log
</span></span></code></pre></div><p>If the user on Windows tries to browse to facebook.com, the censor will see</p>
<p><img alt="log" loading="lazy" src="/images/bash.png"></p>
<h2 id="conclusion-of-this-section">Conclusion of This Section<a hidden class="anchor" aria-hidden="true" href="#conclusion-of-this-section">#</a></h2>
<p>The goal of all of this is to simulate how a repressive government like China could block and poison DNS. One thing to add: since I am not an expert in networking (although I have a Network+ certification), <strong>I LIBERALLY relied on ChatGPT and Perplexity to help resolve problems and develop testing ideas</strong>. All the writing is mine, but much of the technical stuff would have been difficult without AI help.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://censored-state.pages.dev/">Censored State</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
